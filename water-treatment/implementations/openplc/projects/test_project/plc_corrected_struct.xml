<?xml version='1.0' encoding='utf-8'?>
<project xmlns:ns1="http://www.plcopen.org/xml/tc6_0201" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://www.plcopen.org/xml/tc6_0201">
  <fileHeader companyName="CrossPLC" productName="TestProject" productVersion="1.0" creationDateTime="2025-09-19T12:03:00" />
  <contentHeader name="TestProject" modificationDateTime="2025-09-19T12:03:00">
    <coordinateInfo>
      <fbd>
        <scaling x="10" y="10" />
      </fbd>
      <ld>
        <scaling x="10" y="10" />
      </ld>
      <sfc>
        <scaling x="10" y="10" />
      </sfc>
    </coordinateInfo>
  </contentHeader>
  <types>
    <dataTypes>
      <dataType name="HMI_UDT">
        <baseType>
          <struct>
            <variable name="Start_PB">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Stop_PB">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Start_Active">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Stop_Active">
              <type>
                <BOOL />
              </type>
            </variable>
          </struct>
        </baseType>
      </dataType>
      <dataType name="P1_UDT">
        <baseType>
          <struct>
            <variable name="RW_Tank_tnk_lvl">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="RW_Pump_flow">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="RW_Tank_PR_Valve_sts">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RW_Tank_P6B_Valve_sts">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RW_Tank_P_Valve_sts">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RW_Pump_sts">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RW_Pump_fault">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RW_Pump">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="RW_Tank_PR_Valve">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RW_Tank_P_Valve">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RW_Pump_start">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RW_Pump_stop">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RW_Tank_P6B_Valve">
              <type>
                <BOOL />
              </type>
            </variable>
          </struct>
        </baseType>
      </dataType>
      <dataType name="P2_UDT">
        <baseType>
          <struct>
            <variable name="ChemTreat_NaCl_Tank_tnk_lvl">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="ChemTreat_NaOCl_Tank_tnk_lvl">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="ChemTreat_HCl_Tank_tnk_lvl">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="ChemTreat_NaCl_Tank_Valve_sts">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="ChemTreat_NaOCl_Tank_Valve_sts">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="ChemTreat_HCl_Tank_Valve_sts">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="ChemTreat_NaCl_Tank_Valve">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="ChemTreat_NaOCl_Tank_Valve">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="ChemTreat_HCl_Tank_Valve">
              <type>
                <BOOL />
              </type>
            </variable>
          </struct>
        </baseType>
      </dataType>
      <dataType name="P3_UDT">
        <baseType>
          <struct>
            <variable name="Ultrafiltration_UFFT_Tank_tnk_lvl">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="Ultrafiltration_UFFT_Tank_Valve_sts">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Ultrafiltration_UF_Drain_Valve_sts">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Ultrafiltration_UF_ROFT_Valve_sts">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Ultrafiltration_UF_BWP_Valve_sts">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Ultrafiltration_UFFT_Tank_Valve">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Ultrafiltration_UF_Drain_Valve">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Ultrafiltration_UF_ROFT_Valve">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Ultrafiltration_UF_BWP_Valve">
              <type>
                <BOOL />
              </type>
            </variable>
          </struct>
        </baseType>
      </dataType>
      <dataType name="Phases_UDT">
        <baseType>
          <struct>
            <variable name="Filling">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Draining">
              <type>
                <BOOL />
              </type>
            </variable>
          </struct>
        </baseType>
      </dataType>
      <dataType name="RW_tank_AL_UDT">
        <baseType>
          <struct>
            <variable name="LL_alarm">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="L_alarm">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="H_alarm">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="HH_alarm">
              <type>
                <BOOL />
              </type>
            </variable>
          </struct>
        </baseType>
      </dataType>
      <dataType name="System_State_UDT">
        <baseType>
          <struct>
            <variable name="IDLE">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="START">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="RUNNING">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="SHUTDOWN">
              <type>
                <BOOL />
              </type>
            </variable>
            <variable name="Permissives">
              <type>
                <array>
                  <dimension lower="0" upper="31" />
                  <baseType>BOOL</baseType>
                </array>
              </type>
            </variable>
            <variable name="Permissives_Ready">
              <type>
                <BOOL />
              </type>
            </variable>
          </struct>
        </baseType>
      </dataType>
      <dataType name="SYS_MESSAGES">
        <baseType>
          <struct>
            <variable name="ProgramScanTime">
              <type>
                <DINT />
              </type>
            </variable>
            <variable name="AvailableMemory">
              <type>
                <REAL />
              </type>
            </variable>
            <variable name="ControllerStatus">
              <type>
                <SINT />
              </type>
            </variable>
            <variable name="ScanTime">
              <type>
                <REAL />
              </type>
            </variable>
          </struct>
        </baseType>
      </dataType>
    </dataTypes>
    <pous>
      <pou name="MainProgram" pouType="program">
        <interface>
          <inputVars>
            <variable name="Alarms">
              <type>
                <derived name="RW_TANK_AL_UDT" />
              </type>
            </variable>
            <variable name="GSV_Message">
              <type>
                <derived name="SYS_MESSAGES" />
              </type>
            </variable>
            <variable name="P1">
              <type>
                <derived name="P1_UDT" />
              </type>
            </variable>
            <variable name="P1_SYS">
              <type>
                <derived name="SYSTEM_STATE_UDT" />
              </type>
            </variable>
            <variable name="P2">
              <type>
                <derived name="P2_UDT" />
              </type>
            </variable>
            <variable name="P3">
              <type>
                <derived name="P3_UDT" />
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="HMI">
              <type>
                <derived name="HMI_UDT" />
              </type>
            </variable>
          </outputVars>
        </interface>
        <body>
          <ST>
            <xhtml:p>(* IO_setup *)
(* P1 Analog Input *)
P1.RW_Tank_tnk_lvl := Local:7:I.Ch0Data;
P1.RW_Pump_flow := Local:7:I.Ch1Data;
(* P1 Digital Input *)
P1.RW_Tank_PR_Valve_sts := Local:2:I.Data.0;
P1.RW_Tank_P6B_Valve_sts := Local:2:I.Data.1;
P1.RW_Tank_P_Valve_sts := Local:2:I.Data.2;
P1.RW_Pump_sts := Local:2:I.Data.3;
P1.RW_Pump_fault := Local:2:I.Data.4;
(* P1 Analog Output *)
P1.RW_Pump := Local:10:O.Ch0Data;
(* Digital Output *)
P1.RW_Tank_PR_Valve := Local:5:O.Data.0;
P1.RW_Tank_P6B_Valve := Local:5:O.Data.1;
P1.RW_Tank_P_Valve := Local:5:O.Data.2;
P1.RW_Pump_start := Local:5:O.Data.3;
P1.RW_Pump_stop := Local:5:O.Data.4;
(* P1 raw water tank alarms *)
Alarms.LL_alarm := Local:7:I.Ch0LLAlarm;
Alarms.L_alarm := Local:7:I.Ch0LAlarm;
Alarms.H_alarm := Local:7:I.Ch0HAlarm;
Alarms.HH_alarm := Local:7:I.Ch0HHAlarm;
(* P2 Analog Input *)
P2.ChemTreat_NaCl_Tank_tnk_lvl := Local:7:I.Ch2Data;
P2.ChemTreat_NaOCl_Tank_tnk_lvl := Local:7:I.Ch3Data;
P2.ChemTreat_HCl_Tank_tnk_lvl := Local:7:I.Ch4Data;
(* P2 Digital Input *)
P2.ChemTreat_NaCl_Tank_Valve_sts := Local:2:I.Data.5;
P2.ChemTreat_NaOCl_Tank_Valve_sts := Local:2:I.Data.6;
(* P2 Analog Output *)
(* NONE *)
(* P2 Digital Output *)
P2.ChemTreat_NaCl_Tank_Valve := Local:5:O.Data.5;
P2.ChemTreat_NaOCl_Tank_Valve := Local:5:O.Data.6;
P2.ChemTreat_HCl_Tank_Valve := Local:5:O.Data.7;
(* P3 Analog Input *)
P3.Ultrafiltration_UFFT_Tank_tnk_lvl := Local:7:I.Ch5Data;
(* P3 Digital Input *)
P3.Ultrafiltration_UFFT_Tank_Valve_sts := Local:2:I.Data.8;
P3.Ultrafiltration_UF_Drain_Valve_sts := Local:2:I.Data.9;
P3.Ultrafiltration_UF_Drain_Valve_sts := Local:2:I.Data.10;
P3.Ultrafiltration_UF_BWP_Valve_sts := Local:2:I.Data.11;
(* P3 Analog Output *)
(* none *)
(* P3 Digital Output *)
P3.Ultrafiltration_UFFT_Tank_Valve := Local:5:O.Data.8;
P3.Ultrafiltration_UF_Drain_Valve := Local:5:O.Data.9;
P3.Ultrafiltration_UF_ROFT_Valve := Local:5:O.Data.10;
P3.Ultrafiltration_UF_BWP_Valve := Local:5:O.Data.11;

(* Raw_water_control *)
P1.RW_Pump_stop := True;
P1.RW_Pump_start := False; (* send the outputs *)
Alarms.LL_alarm := True;
(* if the level is at 500 or lower than 500 open the valve *)
(* output to turn the valve open *)
P1.RW_Tank_PR_Valve := True;
Alarms.L_alarm := True;
(* if level is at 800 *)
P1.RW_Tank_PR_Valve := False; (* close the valve *)
Alarms.H_alarm := True;
Alarms.HH_alarm := True; (* if the tank is higher than or equal to 1200 set the high high alarm *)

(* Raw_water_pump *)
(* start the pump and open the valve from the other tank *)
P1.RW_Tank_P_Valve := True;
P1.RW_Pump_start := True;
P1.RW_Pump_stop := False;
(* stop the pump and close the valve *)
P1.RW_Tank_P_Valve := False;
P1.RW_Pump_stop := True;
P1.RW_Pump_start := False;

(* State_change *)
(* if start and stop is not pressed go to idle *)
P1_SYS.IDLE := True;
P1_SYS.START := False;
P1_SYS.RUNNING := False;
P1_SYS.SHUTDOWN := False;
(* if the start pb and stop is not pressed then change the state of process one to starting *)
P1_SYS.IDLE := False;
P1_SYS.START := True;
P1_SYS.RUNNING := False;
P1_SYS.SHUTDOWN := False;
(* if the tank level is greater than 250 at the start and UFFT is less than a 1000 we can start *)
(* then and all permissves cond together into one tag so we know the plant is ready to start *)
P1_SYS.Permissives_Ready := P1_SYS.Permissives[0] AND P1_SYS.Permissives[1];
(* if the start was pressed and permissives are ready start running Process one *)
P1_SYS.IDLE := False;
P1_SYS.START := False;
P1_SYS.RUNNING := True;
P1_SYS.SHUTDOWN := False;
(* if the stop button is pressed then go to shutdown state *)
P1_SYS.IDLE := False;
P1_SYS.START := False;
P1_SYS.RUNNING := False;
P1_SYS.SHUTDOWN := True;
(* set all permissives to false *)
P1_SYS.Permissives_Ready := False;
</xhtml:p>
          </ST>
        </body>
      </pou>
    </pous>
  </types>
  <instances>
    <configurations>
      <configuration name="config">
        <resource name="res_MainProgram">
          <task name="task_MainProgram" priority="0" interval="T#100ms" />
          <pouInstance name="MainProgram_instance" typeName="MainProgram" />
        </resource>
      </configuration>
    </configurations>
  </instances>
</project>
