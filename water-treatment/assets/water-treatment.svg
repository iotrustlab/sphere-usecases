<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800" font-family="Arial, Helvetica, sans-serif" font-size="11">
  <defs>
    <!-- Tank symbol -->
    <symbol id="sym-tank" viewBox="0 0 60 80">
      <rect x="2" y="2" width="56" height="76" rx="4" fill="#e8f0f6" stroke="#3a6d8c" stroke-width="2"/>
      <line x1="2" y1="12" x2="58" y2="12" stroke="#3a6d8c" stroke-width="1.5"/>
    </symbol>
    <!-- Valve (butterfly) symbol -->
    <symbol id="sym-valve" viewBox="0 0 30 30">
      <polygon points="0,0 15,15 0,30" fill="#3a6d8c" opacity="0.7"/>
      <polygon points="30,0 15,15 30,30" fill="#3a6d8c" opacity="0.7"/>
      <line x1="15" y1="0" x2="15" y2="30" stroke="#3a6d8c" stroke-width="2"/>
    </symbol>
    <!-- Pump symbol -->
    <symbol id="sym-pump" viewBox="0 0 40 40">
      <circle cx="20" cy="20" r="18" fill="#e8f0f6" stroke="#3a6d8c" stroke-width="2"/>
      <polygon points="8,28 20,8 32,28" fill="#3a6d8c" opacity="0.6"/>
    </symbol>
    <!-- Mixer symbol -->
    <symbol id="sym-mixer" viewBox="0 0 40 40">
      <circle cx="20" cy="20" r="18" fill="#e8f0f6" stroke="#3a6d8c" stroke-width="2"/>
      <line x1="20" y1="6" x2="20" y2="34" stroke="#3a6d8c" stroke-width="2"/>
      <line x1="12" y1="14" x2="28" y2="14" stroke="#3a6d8c" stroke-width="2"/>
      <line x1="12" y1="26" x2="28" y2="26" stroke="#3a6d8c" stroke-width="2"/>
    </symbol>
    <!-- Filter symbol -->
    <symbol id="sym-filter" viewBox="0 0 50 60">
      <rect x="2" y="2" width="46" height="56" rx="3" fill="#e8f0f6" stroke="#3a6d8c" stroke-width="2"/>
      <line x1="10" y1="2" x2="10" y2="58" stroke="#3a6d8c" stroke-width="1" stroke-dasharray="4,3"/>
      <line x1="20" y1="2" x2="20" y2="58" stroke="#3a6d8c" stroke-width="1" stroke-dasharray="4,3"/>
      <line x1="30" y1="2" x2="30" y2="58" stroke="#3a6d8c" stroke-width="1" stroke-dasharray="4,3"/>
      <line x1="40" y1="2" x2="40" y2="58" stroke="#3a6d8c" stroke-width="1" stroke-dasharray="4,3"/>
    </symbol>
    <!-- Sensor cluster symbol -->
    <symbol id="sym-sensor" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="10" fill="none" stroke="#3a6d8c" stroke-width="2"/>
      <text x="12" y="16" text-anchor="middle" font-size="10" fill="#3a6d8c" font-weight="bold">S</text>
    </symbol>
    <!-- UV unit -->
    <symbol id="sym-uv" viewBox="0 0 50 40">
      <rect x="2" y="2" width="46" height="36" rx="3" fill="#f5f0e8" stroke="#3a6d8c" stroke-width="2"/>
      <text x="25" y="24" text-anchor="middle" font-size="12" fill="#3a6d8c" font-weight="bold">UV</text>
    </symbol>
    <!-- RO membrane -->
    <symbol id="sym-ro" viewBox="0 0 60 50">
      <rect x="2" y="2" width="56" height="46" rx="3" fill="#e8f0f6" stroke="#3a6d8c" stroke-width="2"/>
      <line x1="20" y1="2" x2="20" y2="48" stroke="#3a6d8c" stroke-width="1.5" stroke-dasharray="6,3"/>
      <line x1="40" y1="2" x2="40" y2="48" stroke="#3a6d8c" stroke-width="1.5" stroke-dasharray="6,3"/>
    </symbol>
    <!-- Arrow marker -->
    <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#3a6d8c"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1200" height="800" fill="#ffffff"/>

  <!-- Title -->
  <text x="600" y="28" text-anchor="middle" font-size="16" font-weight="bold" fill="#3a6d8c">Water Treatment Process — P&amp;ID</text>

  <!-- ============================================================ -->
  <!-- ROW 1: Raw Water Intake (P1) + Chemical Treatment (P2)       -->
  <!-- ============================================================ -->
  <g id="group-p1">
    <text x="30" y="60" font-size="12" font-weight="bold" fill="#3a6d8c">P1 — Raw Water Intake</text>

    <!-- PUB Raw Water In label -->
    <text x="40" y="110" font-size="10" fill="#555">PUB Raw</text>
    <text x="40" y="122" font-size="10" fill="#555">Water In</text>
    <line x1="80" y1="115" x2="110" y2="115" stroke="#3a6d8c" stroke-width="2" marker-end="url(#arrow)"/>

    <!-- RW_Tank_PR_Valve -->
    <g id="comp-RW_Tank_PR_Valve" transform="translate(115, 100)">
      <use href="#sym-valve" width="24" height="24"/>
      <text x="12" y="36" text-anchor="middle" font-size="8" fill="#555">PR Valve</text>
      <rect id="anchor_RW_Tank_PR_Valve_Sts" x="-2" y="-8" width="28" height="8" fill="transparent"/>
    </g>

    <!-- Pipe to RW_Tank -->
    <line x1="142" y1="115" x2="170" y2="115" stroke="#3a6d8c" stroke-width="2" marker-end="url(#arrow)"/>

    <!-- RW_Tank -->
    <g id="comp-RW_Tank" transform="translate(175, 75)">
      <use href="#sym-tank" width="60" height="80"/>
      <text x="30" y="95" text-anchor="middle" font-size="9" fill="#555">RW Tank</text>
      <rect id="anchor_RW_Tank_Level" x="5" y="20" width="50" height="12" fill="transparent"/>
    </g>

    <!-- RW_Tank_P6B_Valve (on tank side) -->
    <g id="comp-RW_Tank_P6B_Valve" transform="translate(240, 120)">
      <use href="#sym-valve" width="18" height="18"/>
      <text x="9" y="28" text-anchor="middle" font-size="7" fill="#555">P6B</text>
    </g>

    <!-- Pipe from tank -->
    <line x1="238" y1="115" x2="275" y2="115" stroke="#3a6d8c" stroke-width="2"/>

    <!-- RW_Tank_P_Valve -->
    <g id="comp-RW_Tank_P_Valve" transform="translate(278, 100)">
      <use href="#sym-valve" width="24" height="24"/>
      <text x="12" y="36" text-anchor="middle" font-size="8" fill="#555">P Valve</text>
      <rect id="anchor_RW_Tank_P_Valve_Sts" x="-2" y="-8" width="28" height="8" fill="transparent"/>
    </g>

    <!-- Pipe to pump -->
    <line x1="305" y1="115" x2="340" y2="115" stroke="#3a6d8c" stroke-width="2" marker-end="url(#arrow)"/>

    <!-- RW_Pump -->
    <g id="comp-RW_Pump" transform="translate(345, 95)">
      <use href="#sym-pump" width="40" height="40"/>
      <text x="20" y="52" text-anchor="middle" font-size="9" fill="#555">RW Pump</text>
      <rect id="anchor_RW_Pump_Speed" x="-10" y="-16" width="60" height="12" fill="transparent"/>
      <rect id="anchor_RW_Pump_Flow" x="-10" y="55" width="60" height="12" fill="transparent"/>
      <rect id="anchor_RW_Pump_Sts" x="42" y="5" width="12" height="12" fill="transparent"/>
    </g>

    <!-- Pipe out from pump -->
    <line x1="388" y1="115" x2="420" y2="115" stroke="#3a6d8c" stroke-width="2" marker-end="url(#arrow)"/>
  </g>

  <!-- P2 — Chemical Treatment -->
  <g id="group-p2">
    <text x="500" y="60" font-size="12" font-weight="bold" fill="#3a6d8c">P2 — Chemical Treatment</text>

    <!-- ChemTreat_NaCl_Tank -->
    <g id="comp-ChemTreat_NaCl" transform="translate(500, 75)">
      <use href="#sym-tank" width="50" height="65"/>
      <text x="25" y="78" text-anchor="middle" font-size="8" fill="#555">NaCl</text>
      <rect id="anchor_ChemTreat_NaCl_Level" x="5" y="15" width="40" height="12" fill="transparent"/>
    </g>
    <g transform="translate(512, 145)">
      <use href="#sym-valve" width="18" height="18"/>
    </g>
    <line x1="521" y1="142" x2="521" y2="175" stroke="#3a6d8c" stroke-width="1.5"/>

    <!-- ChemTreat_NaOCl_Tank -->
    <g id="comp-ChemTreat_NaOCl" transform="translate(580, 75)">
      <use href="#sym-tank" width="50" height="65"/>
      <text x="25" y="78" text-anchor="middle" font-size="8" fill="#555">NaOCl</text>
      <rect id="anchor_ChemTreat_NaOCl_Level" x="5" y="15" width="40" height="12" fill="transparent"/>
    </g>
    <g transform="translate(592, 145)">
      <use href="#sym-valve" width="18" height="18"/>
    </g>
    <line x1="601" y1="142" x2="601" y2="175" stroke="#3a6d8c" stroke-width="1.5"/>

    <!-- ChemTreat_HCl_Tank -->
    <g id="comp-ChemTreat_HCl" transform="translate(660, 75)">
      <use href="#sym-tank" width="50" height="65"/>
      <text x="25" y="78" text-anchor="middle" font-size="8" fill="#555">HCl</text>
      <rect id="anchor_ChemTreat_HCl_Level" x="5" y="15" width="40" height="12" fill="transparent"/>
    </g>
    <g transform="translate(672, 145)">
      <use href="#sym-valve" width="18" height="18"/>
    </g>
    <line x1="681" y1="142" x2="681" y2="175" stroke="#3a6d8c" stroke-width="1.5"/>

    <!-- Chemical dosing pipe (horizontal manifold) -->
    <line x1="521" y1="175" x2="681" y2="175" stroke="#3a6d8c" stroke-width="2"/>
    <line x1="601" y1="175" x2="601" y2="195" stroke="#3a6d8c" stroke-width="2" marker-end="url(#arrow)"/>
  </g>

  <!-- ============================================================ -->
  <!-- ROW 2: Ultrafiltration (P3)                                  -->
  <!-- ============================================================ -->
  <g id="group-p3">
    <text x="30" y="210" font-size="12" font-weight="bold" fill="#3a6d8c">P3 — Ultrafiltration</text>

    <!-- Main line in from P1 -->
    <line x1="420" y1="115" x2="420" y2="240" stroke="#3a6d8c" stroke-width="2"/>
    <line x1="420" y1="240" x2="460" y2="240" stroke="#3a6d8c" stroke-width="2" marker-end="url(#arrow)"/>

    <!-- Chemical dosing joins main line -->
    <line x1="601" y1="195" x2="601" y2="240" stroke="#3a6d8c" stroke-width="2"/>
    <line x1="520" y1="240" x2="601" y2="240" stroke="#3a6d8c" stroke-width="1.5"/>

    <!-- UF_Drain_Valve -->
    <g id="comp-UF_Drain_Valve" transform="translate(465, 228)">
      <use href="#sym-valve" width="24" height="24"/>
      <text x="12" y="36" text-anchor="middle" font-size="7" fill="#555">Drain V</text>
    </g>

    <!-- Pipe to UltraFilter -->
    <line x1="492" y1="240" x2="530" y2="240" stroke="#3a6d8c" stroke-width="2" marker-end="url(#arrow)"/>

    <!-- UltraFilter -->
    <g id="comp-UltraFilter" transform="translate(535, 210)">
      <use href="#sym-filter" width="50" height="60"/>
      <text x="25" y="72" text-anchor="middle" font-size="9" fill="#555">UltraFilter</text>
    </g>

    <!-- Pipe to UF_Pump -->
    <line x1="588" y1="240" x2="625" y2="240" stroke="#3a6d8c" stroke-width="2" marker-end="url(#arrow)"/>

    <!-- UF_Pump -->
    <g id="comp-UF_Pump" transform="translate(630, 220)">
      <use href="#sym-pump" width="40" height="40"/>
      <text x="20" y="52" text-anchor="middle" font-size="9" fill="#555">UF Pump</text>
    </g>

    <!-- Pipe to UF_Tank_Valve -->
    <line x1="673" y1="240" x2="710" y2="240" stroke="#3a6d8c" stroke-width="2" marker-end="url(#arrow)"/>

    <!-- UF_Tank_Valve -->
    <g id="comp-UF_Tank_Valve" transform="translate(715, 228)">
      <use href="#sym-valve" width="24" height="24"/>
      <text x="12" y="36" text-anchor="middle" font-size="7" fill="#555">UF Tank V</text>
    </g>

    <!-- Pipe to UF_Tank -->
    <line x1="742" y1="240" x2="780" y2="240" stroke="#3a6d8c" stroke-width="2" marker-end="url(#arrow)"/>

    <!-- UF_Tank (UFFT) -->
    <g id="comp-UF_Tank" transform="translate(785, 200)">
      <use href="#sym-tank" width="60" height="80"/>
      <text x="30" y="95" text-anchor="middle" font-size="9" fill="#555">UF Tank</text>
      <rect id="anchor_UF_UFFT_Tank_Level" x="5" y="20" width="50" height="12" fill="transparent"/>
    </g>
  </g>

  <!-- ============================================================ -->
  <!-- ROW 3: Dechlorination / Backwash                             -->
  <!-- ============================================================ -->
  <g id="group-p4">
    <text x="30" y="340" font-size="12" font-weight="bold" fill="#3a6d8c">P4 — Dechlorination</text>

    <!-- UF_ROFT_Valve from UF Tank down -->
    <line x1="815" y1="282" x2="815" y2="370" stroke="#3a6d8c" stroke-width="2"/>
    <line x1="815" y1="370" x2="780" y2="370" stroke="#3a6d8c" stroke-width="2"/>

    <!-- UF_ROFT_Valve -->
    <g id="comp-UF_ROFT_Valve" transform="translate(752, 358)">
      <use href="#sym-valve" width="24" height="24"/>
      <text x="12" y="36" text-anchor="middle" font-size="7" fill="#555">ROFT V</text>
    </g>

    <!-- Backwash branch -->
    <text x="870" y="340" font-size="10" font-weight="bold" fill="#3a6d8c">Backwash</text>

    <line x1="848" y1="370" x2="890" y2="370" stroke="#3a6d8c" stroke-width="2"/>

    <!-- UF_BWP_Valve -->
    <g id="comp-UF_BWP_Valve" transform="translate(895, 358)">
      <use href="#sym-valve" width="24" height="24"/>
      <text x="12" y="36" text-anchor="middle" font-size="7" fill="#555">BWP V</text>
    </g>

    <!-- Pipe to BW_Pump -->
    <line x1="922" y1="370" x2="955" y2="370" stroke="#3a6d8c" stroke-width="2" marker-end="url(#arrow)"/>

    <!-- BW_Pump -->
    <g id="comp-BW_Pump" transform="translate(960, 350)">
      <use href="#sym-pump" width="40" height="40"/>
      <text x="20" y="52" text-anchor="middle" font-size="9" fill="#555">BW Pump</text>
    </g>

    <!-- Pipe to BW_Tank -->
    <line x1="1003" y1="370" x2="1040" y2="370" stroke="#3a6d8c" stroke-width="2" marker-end="url(#arrow)"/>

    <!-- BW_Tank -->
    <g id="comp-BW_Tank" transform="translate(1045, 330)">
      <use href="#sym-tank" width="60" height="80"/>
      <text x="30" y="95" text-anchor="middle" font-size="9" fill="#555">BW Tank</text>
    </g>

    <!-- Main line from ROFT Valve leftward -->
    <line x1="749" y1="370" x2="620" y2="370" stroke="#3a6d8c" stroke-width="2"/>

    <!-- Dechlorination_UV -->
    <g id="comp-Dechlor_UV" transform="translate(570, 350)">
      <use href="#sym-uv" width="50" height="40"/>
      <text x="25" y="52" text-anchor="middle" font-size="8" fill="#555">UV Unit</text>
    </g>

    <!-- Pipe from UV to RO_Pump -->
    <line x1="567" y1="370" x2="520" y2="370" stroke="#3a6d8c" stroke-width="2"/>

    <!-- Dechlorination_RO_Pump -->
    <g id="comp-Dechlor_RO_Pump" transform="translate(475, 350)">
      <use href="#sym-pump" width="40" height="40"/>
      <text x="20" y="52" text-anchor="middle" font-size="8" fill="#555">RO Pump</text>
    </g>

    <!-- Pipe to ROFT_Valve -->
    <line x1="472" y1="370" x2="420" y2="370" stroke="#3a6d8c" stroke-width="2"/>

    <!-- ROFT_Valve -->
    <g id="comp-ROFT_Valve" transform="translate(390, 358)">
      <use href="#sym-valve" width="24" height="24"/>
      <text x="12" y="36" text-anchor="middle" font-size="7" fill="#555">ROFT V</text>
    </g>

    <!-- Pipe to Dechlorination ROFT Tank -->
    <line x1="387" y1="370" x2="330" y2="370" stroke="#3a6d8c" stroke-width="2"/>

    <!-- Dechlorination_ROFT_Tank -->
    <g id="comp-Dechlor_ROFT_Tank" transform="translate(265, 330)">
      <use href="#sym-tank" width="60" height="80"/>
      <text x="30" y="95" text-anchor="middle" font-size="9" fill="#555">ROFT Tank</text>
    </g>
  </g>

  <!-- ============================================================ -->
  <!-- ROW 4: NaHSO3 dosing + Cartridge Filter + RO                 -->
  <!-- ============================================================ -->
  <g id="group-p5">
    <text x="30" y="460" font-size="12" font-weight="bold" fill="#3a6d8c">P5 — Reverse Osmosis</text>

    <!-- NaHSO3 tank -->
    <g id="comp-NaHSO3_Tank" transform="translate(100, 480)">
      <use href="#sym-tank" width="50" height="65"/>
      <text x="25" y="78" text-anchor="middle" font-size="8" fill="#555">NaHSO3</text>
    </g>
    <g transform="translate(112, 550)">
      <use href="#sym-valve" width="18" height="18"/>
    </g>
    <line x1="121" y1="548" x2="121" y2="570" stroke="#3a6d8c" stroke-width="1.5"/>

    <!-- Pipe from ROFT tank down to cartridge filter -->
    <line x1="295" y1="412" x2="295" y2="505" stroke="#3a6d8c" stroke-width="2"/>
    <line x1="295" y1="505" x2="350" y2="505" stroke="#3a6d8c" stroke-width="2"/>

    <!-- NaHSO3 dosing joins line -->
    <line x1="121" y1="570" x2="295" y2="570" stroke="#3a6d8c" stroke-width="1.5"/>
    <line x1="295" y1="530" x2="295" y2="570" stroke="#3a6d8c" stroke-width="1.5"/>

    <!-- Cartridge_Filter -->
    <g id="comp-Cartridge_Filter" transform="translate(355, 475)">
      <use href="#sym-filter" width="50" height="60"/>
      <text x="25" y="72" text-anchor="middle" font-size="8" fill="#555">Cart. Filter</text>
    </g>

    <!-- Pipe to RO_Pump -->
    <line x1="408" y1="505" x2="460" y2="505" stroke="#3a6d8c" stroke-width="2" marker-end="url(#arrow)"/>

    <!-- RO_Pump -->
    <g id="comp-RO_Pump" transform="translate(465, 485)">
      <use href="#sym-pump" width="40" height="40"/>
      <text x="20" y="52" text-anchor="middle" font-size="9" fill="#555">RO Pump</text>
    </g>

    <!-- Pipe to RO membrane -->
    <line x1="508" y1="505" x2="560" y2="505" stroke="#3a6d8c" stroke-width="2" marker-end="url(#arrow)"/>

    <!-- RO membrane -->
    <g id="comp-RO_Membrane" transform="translate(565, 480)">
      <use href="#sym-ro" width="60" height="50"/>
      <text x="30" y="62" text-anchor="middle" font-size="9" fill="#555">RO Membrane</text>
    </g>

    <!-- Pipe to RO_Tank_Valve -->
    <line x1="628" y1="505" x2="670" y2="505" stroke="#3a6d8c" stroke-width="2" marker-end="url(#arrow)"/>

    <!-- RO_Tank_Valve -->
    <g id="comp-RO_Tank_Valve" transform="translate(675, 493)">
      <use href="#sym-valve" width="24" height="24"/>
      <text x="12" y="36" text-anchor="middle" font-size="7" fill="#555">RO Tank V</text>
    </g>

    <!-- Pipe to RO_Tank -->
    <line x1="702" y1="505" x2="740" y2="505" stroke="#3a6d8c" stroke-width="2" marker-end="url(#arrow)"/>

    <!-- RO_Tank -->
    <g id="comp-RO_Tank" transform="translate(745, 465)">
      <use href="#sym-tank" width="60" height="80"/>
      <text x="30" y="95" text-anchor="middle" font-size="9" fill="#555">RO Tank</text>
    </g>
  </g>

  <!-- ============================================================ -->
  <!-- ROW 5: Permeate Tank + Water Distribution out                -->
  <!-- ============================================================ -->
  <g id="group-p6">
    <text x="30" y="620" font-size="12" font-weight="bold" fill="#3a6d8c">P6 — Permeate / Output</text>

    <!-- Pipe from RO Tank down -->
    <line x1="775" y1="547" x2="775" y2="660" stroke="#3a6d8c" stroke-width="2"/>

    <!-- Permeate_Tank_RO_Valve -->
    <g id="comp-Permeate_RO_Valve" transform="translate(688, 648)">
      <use href="#sym-valve" width="24" height="24"/>
      <text x="12" y="36" text-anchor="middle" font-size="7" fill="#555">Perm V</text>
    </g>

    <line x1="775" y1="660" x2="715" y2="660" stroke="#3a6d8c" stroke-width="2"/>
    <line x1="685" y1="660" x2="620" y2="660" stroke="#3a6d8c" stroke-width="2"/>

    <!-- Permeate_Tank -->
    <g id="comp-Permeate_Tank" transform="translate(555, 620)">
      <use href="#sym-tank" width="60" height="80"/>
      <text x="30" y="95" text-anchor="middle" font-size="9" fill="#555">Permeate Tank</text>
    </g>

    <!-- Output to Water Distribution -->
    <line x1="775" y1="660" x2="900" y2="660" stroke="#3a6d8c" stroke-width="2" marker-end="url(#arrow)"/>
    <text x="910" y="655" font-size="10" fill="#555">To Water</text>
    <text x="910" y="667" font-size="10" fill="#555">Distribution</text>
  </g>

  <!-- ============================================================ -->
  <!-- System status anchors                                        -->
  <!-- ============================================================ -->
  <g id="group-sys">
    <rect id="anchor_SYS_RUNNING" x="500" y="760" width="60" height="14" fill="transparent"/>
    <rect id="anchor_SYS_IDLE" x="580" y="760" width="60" height="14" fill="transparent"/>
    <text x="530" y="772" text-anchor="middle" font-size="10" fill="#8b949e">SYS</text>
  </g>

  <!-- Alarm anchors -->
  <g id="group-alm">
    <rect id="anchor_Alarm_RW_Tank_HH" x="175" y="65" width="60" height="12" fill="transparent"/>
  </g>
</svg>
