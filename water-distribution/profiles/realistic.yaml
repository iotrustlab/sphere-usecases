# Realistic simulation profile for SPHERE Water Distribution UC0
# Research-grounded defaults for accurate physical modeling
#
# Sources:
#   - USACE EM 1110-2-503 (water system design, demand patterns)
#   - AWWA M32 (distribution system modeling)
#   - EPA EPANET documentation (tank sizing, pump curves)
#   - Ten States Standards (pressure, storage requirements)
#   - AUMA SA 07.1/SA 16.1 datasheets (motorized valve actuators)
#   - ABB VFD quick ramps guide (pump acceleration)
#   - VEGA/Siemens sensor datasheets (level/flow response times)

api_version: sphere.mergetb.io/v1
kind: SimProfile
metadata:
  name: realistic
  version: "1.0.0"
  description: Research-grounded realistic timing for validation
  basis: "USACE EM 1110-2-503, AWWA M32, EPA EPANET, AUMA datasheets, Ten States Standards"

timing:
  dt_sec: 0.1            # Simulation timestep
  poll_interval_ms: 500  # Tag polling interval

actuators:
  # Motorized valve: large ball/butterfly valves with electric actuators
  # Research: 30-110s for 90-degree travel (Bray/AUMA)
  # Using 60s as mid-range for distribution system valves
  motorized_valve:
    tau_sec: 60.0

  # Solenoid valve: fast-acting on/off for chemical dosing
  # Research: 20-100ms typical response
  solenoid_valve:
    tau_sec: 0.05

  # Pump dynamics
  # Research: VFD ramps 0-360s adjustable, 10s typical
  pump:
    spinup_sec: 2.0       # Motor start to rotation
    vfd_accel_sec: 10.0   # VFD ramp to target speed

  # Per-tag type overrides (tag_name -> actuator class)
  overrides:
    # All valves in WD are motorized isolation valves
    # No solenoid overrides needed for UC0

sensors:
  # Level sensors (ultrasonic/radar): slow response, moderate noise
  # Research: VEGA update 2-3s, damping up to 999s
  level:
    tau_sec: 5.0
    noise_sigma: 2.0     # mm

  # Flow sensors (mag flow): faster response, lower noise
  # Research: Siemens 0.1-30s configurable, 2s typical with filtering
  flow:
    tau_sec: 2.0
    noise_sigma: 0.5     # L/min

alarms:
  # Alarm setpoints as percentage of span
  # Industry standard: LL=10%, L=20%, H=80%, HH=95%
  Supply_Tank:
    span_mm: 1500         # Matches tag_contract.yaml range [0, 1500]
    ll_pct: 10
    l_pct: 20
    h_pct: 80
    hh_pct: 80            # HH at 1200mm per tag_contract alarm threshold

  Grid_Elev_Tank:
    span_mm: 2000         # Matches tag_contract.yaml range [0, 2000]
    ll_pct: 10
    l_pct: 20
    h_pct: 80
    hh_pct: 95

  Grid_Consum_Tank:
    span_mm: 2000         # Matches tag_contract.yaml range [0, 2000]
    ll_pct: 10
    l_pct: 20
    h_pct: 80
    hh_pct: 95

  RWS_Tank:
    span_mm: 1500         # Matches tag_contract.yaml range [0, 1500]
    ll_pct: 10
    l_pct: 20
    h_pct: 80
    hh_pct: 95

physics:
  # Supply Tank - Clearwell receiving treated water
  # Research: 40,000 gal (151 m³) typical for ~100 connections
  # With 4m depth → area ≈ 40 m²
  Supply_Tank:
    max_mm: 1500           # Matches tag_contract
    area_m2: 40.0          # Research: ~40,000 gal clearwell
    inflow_lpm: 150        # Inflow from treatment plant
    pump_max_lpm: 380      # 100 gpm = 378 L/min max pump flow

  # NaOCl/NH4Cl dosing tanks (chemical day tanks)
  # Research: 100L (26 gal) typical for small systems
  NaOCl_Tank:
    max_mm: 1000
    area_m2: 0.1           # Small chemical tank
    dose_rate_lpm: 0.038   # 1 GPH = 0.063 L/min

  NH4Cl_Tank:
    max_mm: 1000
    area_m2: 0.1
    dose_rate_lpm: 0.019   # 0.5 GPH for ammonia

  # Elevated Storage Tank - Provides system pressure
  # Research: 100,000 gal (379 m³) typical for distribution
  # With 6m (20ft) depth → area ≈ 60 m²
  Grid_Elev_Tank:
    max_mm: 6000           # 6m = ~20ft water depth
    area_m2: 60.0          # Research: ~100,000 gal elevated tank
    drain_lpm: 300         # Gravity drain to distribution

  # Consumer Storage Tank - Zone buffer
  # Research: 10,000 gal (38 m³) for small zone
  # With 4m depth → area ≈ 10 m²
  Grid_Consum_Tank:
    max_mm: 4000           # 4m water depth
    area_m2: 10.0          # Research: ~10,000 gal zone tank

  # Return Water System Tank - Recirculation buffer
  # Research: 200 gal (760L) with 2.5m height → area ≈ 0.3 m²
  RWS_Tank:
    max_mm: 1500
    area_m2: 0.3           # Research: ~200 gal return tank

pumps:
  # Supply Pump - Booster from clearwell to distribution
  # Research: 100 gpm (378 L/min) for ~100 connections
  Supply_Pump:
    max_flow_lpm: 380      # 100 gpm
    max_flow_m3s: 0.0063   # 100 gpm = 0.0063 m³/s

  # RWS Pump - Return water recirculation
  # Research: 10 gpm (38 L/min) for recirculation loop
  RWS_Pump:
    max_flow_lpm: 38       # 10 gpm
    max_flow_m3s: 0.00063  # 10 gpm = 0.00063 m³/s

demand:
  # Base demand per connection
  # Research: 400 gpd/connection typical residential
  base_demand_gpd_per_conn: 400

  # Number of connections served
  connections: 100

  # Peaking factors (dimensionless)
  # Research: MDD/ADD = 2.0, PHD/ADD = 4.5 typical
  mdd_factor: 2.0          # Max day demand / avg day demand
  phd_factor: 4.5          # Peak hour demand / avg day demand

  # Unaccounted-for water (UFW) / leakage
  # Research: 13% typical for small systems
  ufw_fraction: 0.13

  # Return-to-RWS fraction
  # Research: 90% of consumption becomes return flow
  return_fraction: 0.90

  # Diurnal demand pattern (24-hour multipliers)
  # Research: EPANET-style residential pattern
  diurnal_pattern:
    - { hour: 0, mult: 0.5 }
    - { hour: 1, mult: 0.4 }
    - { hour: 2, mult: 0.3 }
    - { hour: 3, mult: 0.3 }
    - { hour: 4, mult: 0.4 }
    - { hour: 5, mult: 0.6 }
    - { hour: 6, mult: 1.0 }
    - { hour: 7, mult: 1.4 }
    - { hour: 8, mult: 1.3 }
    - { hour: 9, mult: 1.1 }
    - { hour: 10, mult: 1.0 }
    - { hour: 11, mult: 1.0 }
    - { hour: 12, mult: 1.1 }
    - { hour: 13, mult: 1.0 }
    - { hour: 14, mult: 0.9 }
    - { hour: 15, mult: 0.9 }
    - { hour: 16, mult: 1.0 }
    - { hour: 17, mult: 1.2 }
    - { hour: 18, mult: 1.4 }
    - { hour: 19, mult: 1.3 }
    - { hour: 20, mult: 1.1 }
    - { hour: 21, mult: 1.0 }
    - { hour: 22, mult: 0.8 }
    - { hour: 23, mult: 0.6 }
